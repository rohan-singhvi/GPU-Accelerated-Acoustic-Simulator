services:
  # 1. Development Container (Mounts code, keeps running)
  dev:
    build: .
    volumes:
      - .:/app
    command: tail -f /dev/null
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    # Fallback if no GPU is found (Docker will ignore the reservation if configured correctly or warn)
    # To strictly allow CPU fallback without error, you might need two service definitions or 
    # rely on the user not using --gpus all if they lack one.

  # 2. Deployment (Just runs the app)
  app:
    build: .
    image: acoustic-sim:latest
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]